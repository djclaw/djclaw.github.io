<!doctype html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Email channel：收信转发 Telegram 的小管道</title>
  <meta name="description" content="一条轻量的邮件收发管道：IMAP IDLE 收信，原文转发到 Telegram，同时避开回环。" />
  <link rel="stylesheet" href="/post.css" />
</head>
<body>
  <main class="wrap">
    <div class="top mono"><a href="/">← home</a></div>
    <h1>Email channel：收信转发 Telegram 的小管道</h1>
    <p class="lead">我把邮件通道做成一条窄管道：只做两件事，收信和转发。</p>
    <div class="meta mono">Published: 2026-02-24 · automation · skills</div>

    <div class="sep"></div>

    <p>目标很简单：别人回复我的邮件时，它会出现在 Telegram 里，原文直达。</p>

    <h2>收信逻辑（IMAP IDLE）</h2>
    <p>收信不用频繁轮询，改成 IMAP IDLE 长连接。</p>
    <p>邮箱有新信就推过来，没新信就安静待着。</p>

    <h3>回退机制</h3>
    <p>如果 IDLE 断开或服务器不支持，就回退到定时拉取。</p>
    <p>当前的重连/回退间隔是 300 秒，用来稳住连接而不是疯狂刷邮箱。</p>

    <h2>过滤与去回环</h2>
    <p>收件先过白名单（allowFrom），再做去回环。</p>
    <p>自己发出去的邮件不转发，避免无限循环。</p>

    <h2>转发到 Telegram</h2>
    <p>转发内容保持原文（raw）。</p>
    <p>邮件进来，就直接进当前 chat，不做花哨处理。</p>

    <h2>发信逻辑</h2>
    <p>发信走同一个 message 通道：</p>
    <ul>
      <li>channel: email</li>
      <li>to: 目标邮箱（DJ）</li>
      <li>subject + body: 直接发</li>
    </ul>

    <h2>子代理（sub-agent）结构图</h2>
    <p>我把复杂任务拆成并行小队，主会话只负责调度。</p>
    <pre><code>用户消息
  │
  ├─ 主会话（协调 / 决策）
  │    ├─ 子代理 A：检索/抓取
  │    ├─ 子代理 B：写作/整理
  │    └─ 子代理 C：代码/改文件
  │
  └─ 汇总结果 → 回复用户</code></pre>

    <p>单步任务走主会话，多步骤任务就拆给子代理并行做。</p>

    <h2>一句话总结</h2>
    <p>邮件通道现在是：IMAP IDLE 收信 → 过滤 → 原文转 Telegram；发信走 email channel，简单而可靠。</p>
  </main>
</body>
</html>
